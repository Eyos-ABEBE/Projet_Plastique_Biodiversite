<meta charset="utf-8" />

<head>
  <title>Plastic Pollution</title>
  <meta charset="utf-8" />
  <!-- <script src="https://d3js.org/d3.v6.min.js"></script> -->
  <script src="script.js"></script>
  <link rel="stylesheet" href="style.css" />

  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>

<body>
  <div class="main">
    <div>
      <h1>Storyline 1</h1>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur
        faucibus enim felis, nec semper orci cursus at. Nunc a consectetur diam.
        Duis elementum malesuada enim, vitae condimentum odio facilisis et.
        Nulla ullamcorper odio sit amet nunc semper, in mattis nulla tempor.
        Praesent ac venenatis dolor. Integer efficitur elit ut velit convallis,
        at vulputate odio sodales. Fusce eu sapien elementum, posuere arcu nec,
        viverra purus. Suspendisse dictum vestibulum velit eget fermentum. Sed
        finibus sagittis enim, nec semper orci suscipit non. Morbi ut sem non
        orci ultrices sagittis. Suspendisse eu velit vulputate, iaculis risus a,
        congue tortor. Proin sed neque neque. Sed vitae metus ac tellus congue
        tincidunt. Praesent eleifend felis lobortis nisl venenatis, in tincidunt
        justo elementum. Sed interdum a tortor mollis aliquet. Fusce mollis enim
        turpis, non tincidunt tellus blandit sed. Curabitur vitae sem ut ante
        auctor dignissim id eget diam. Sed ac convallis dui. Quisque finibus
        orci in arcu laoreet, a facilisis dui dictum. Maecenas tincidunt nunc at
        varius eleifend. Suspendisse at tortor eget lorem fringilla ullamcorper.
        Nam imperdiet, diam sed aliquam pellentesque, turpis mauris accumsan
        enim, at laoreet nulla ante sed libero.
      </p>
    </div>

    <div>
      <h1>Storyline 2</h1>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur
        faucibus enim felis, nec semper orci cursus at. Nunc a consectetur diam.
        Duis elementum malesuada enim, vitae condimentum odio facilisis et.
        Nulla ullamcorper odio sit amet nunc semper, in mattis nulla tempor.
        Praesent ac venenatis dolor. Integer efficitur elit ut velit convallis,
        at vulputate odio sodales. Fusce eu sapien elementum, posuere arcu nec,
        viverra purus. Suspendisse dictum vestibulum velit eget fermentum. Sed
        finibus sagittis enim, nec semper orci suscipit non. Morbi ut sem non
        orci ultrices sagittis. Suspendisse eu velit vulputate, iaculis risus a,
        congue tortor. Proin sed neque neque. Sed vitae metus ac tellus congue
        tincidunt. Praesent eleifend felis lobortis nisl venenatis, in tincidunt
        justo elementum. Sed interdum a tortor mollis aliquet. Fusce mollis enim
        turpis, non tincidunt tellus blandit sed. Curabitur vitae sem ut ante
        auctor dignissim id eget diam. Sed ac convallis dui. Quisque finibus
        orci in arcu laoreet, a facilisis dui dictum. Maecenas tincidunt nunc at
        varius eleifend. Suspendisse at tortor eget lorem fringilla ullamcorper.
        Nam imperdiet, diam sed aliquam pellentesque, turpis mauris accumsan
        enim, at laoreet nulla ante sed libero.
      </p>
    </div>

    <div id="viz" class="visualisation__top">
      <button type="button" onclick="clicked('Europe')">Europe</button>
      <button type="button" onclick="clicked('Asia')">Asia</button>
      <button type="button" onclick="clicked('Africa')">Africa</button>
      <button type="button" onclick="clicked('Oceania')">Oceania</button>
      <button type="button" onclick="clicked('North America')">
        North America
      </button>
      <button type="button" onclick="clicked('South America')">
        South America
      </button>

      <!-- Create an element where the map will take place -->
      <svg id="my_dataviz" width="600" height="300"></svg>
      <p>visualisation 1</p>
    </div>
    <div id="div1" style="display: block;" class="visualisation__bottom">
      <p>visualisation 2.1</p>
    </div>
    <div id="div2" style="display: none;" class="visualisation__bottom">
      <p>visualisation 2.2</p>
    </div>
    <div id="div3" style="display: none;" class="visualisation__bottom">
      <p>visualisation 2.3</p>
    </div>
    <div id="div4" style="display: none;" class="visualisation__bottom">
      <p>visualisation 2.4</p>
    </div>
    <div id="div5" style="display: none;" class="visualisation__bottom">
      <p>visualisation 2.5</p>
    </div>

    <div>
      <h1>Storyline 3</h1>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur
        faucibus enim felis, nec semper orci cursus at. Nunc a consectetur diam.
        Duis elementum malesuada enim, vitae condimentum odio facilisis et.
        Nulla ullamcorper odio sit amet nunc semper, in mattis nulla tempor.
        Praesent ac venenatis dolor. Integer efficitur elit ut velit convallis,
        at vulputate odio sodales. Fusce eu sapien elementum, posuere arcu nec,
        viverra purus. Suspendisse dictum vestibulum velit eget fermentum. Sed
        finibus sagittis enim, nec semper orci suscipit non. Morbi ut sem non
        orci ultrices sagittis. Suspendisse eu velit vulputate, iaculis risus a,
        congue tortor. Proin sed neque neque. Sed vitae metus ac tellus congue
        tincidunt. Praesent eleifend felis lobortis nisl venenatis, in tincidunt
        justo elementum. Sed interdum a tortor mollis aliquet. Fusce mollis enim
        turpis, non tincidunt tellus blandit sed. Curabitur vitae sem ut ante
        auctor dignissim id eget diam. Sed ac convallis dui. Quisque finibus
        orci in arcu laoreet, a facilisis dui dictum. Maecenas tincidunt nunc at
        varius eleifend. Suspendisse at tortor eget lorem fringilla ullamcorper.
        Nam imperdiet, diam sed aliquam pellentesque, turpis mauris accumsan
        enim, at laoreet nulla ante sed libero.
      </p>
    </div>

    <p id="demo"></p>
  </div>
  <script>
    // The svg
    var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height");
    // Map and projection
    var path = d3.geoPath();
    var projection = d3
      .geoMercator()
      .scale(70)
      .center([0, 20])
      .translate([width / 2, height / 2]);
    // Data and color scale
    var data = d3.map();
    var color = d3
      .scaleQuantize()
      .range([
        "#84f6fa",
        "#3edef7",
        "#2bbafc",
        "#1787ff",
        "#1774ff",
        "#002fff"
      ]);

    const zoom = d3
      .zoom()
      .scaleExtent([1, 8])
      .translateExtent([
        [0, 0],
        [600, 300]
      ])
      .on("zoom", zoomed);
    svg.call(zoom);

    // Load external data and boot
    d3.queue()
      .defer(
        d3.json,
        "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"
      )
      .await(ready);

    //WCMC-019-PatternsBiodiversity2010-AcrossTaxa.csv
    d3.csv("WCMC-019-PatternsBiodiversity2010-AcrossTaxa.csv", function (data) {
      tab_color = [];
      data.sort(function (a, b) {
        return b["Y_COORD,N,18,5"] - a["Y_COORD,N,18,5"];
      });
      for (var j = 0; j < data.length; j++) {
        tab_color.push(data[j]["AllNorm,N,19,11"]);
      }
      color.domain([d3.min(tab_color), d3.max(tab_color)]);

      var sum = 0;
      var dists = {};

      //calcul des distances entre chaque point
      for (var i = 0; i < 13; i++) {
        dists[i] = Math.abs(
          projection([
            data[i * 45]["X_COORD,N,18,5"],
            data[i * 45]["Y_COORD,N,18,5"]
          ])[1] -
            projection([
              data[(i + 1) * 45]["X_COORD,N,18,5"],
              data[(i + 1) * 45]["Y_COORD,N,18,5"]
            ])[1]
        );
        sum += dists[i];
      }

      //hauteur des cases de la premiÃ¨re ligne
      firstH = document.getElementById("my_dataviz").clientHeight - sum;

      //calcul des hauteurs pour chaque case de chaque ligne
      for (var i = 0; i < data.length; i++) {
        var numLine = Math.floor(i / 45);
        if (numLine == 0) data[i]["height"] = firstH;
        else
          data[i]["height"] =
            (dists[numLine - 1] - data[(numLine - 1) * 45]["height"] / 2) * 2;
      }

      svg
        .selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr(
          "x",
          (d) =>
            projection([
              d["X_COORD,N,18,5"] - (440 / 6378) * (180 / Math.PI),
              d["Y_COORD,N,18,5"]
            ])[0]
        )
        .attr(
          "y",
          (d) =>
            projection([
              d["X_COORD,N,18,5"] - (440 / 6378) * (180 / Math.PI),
              d["Y_COORD,N,18,5"]
            ])[1] -
            d["height"] / 2
        )
        .attr("width", 600 / 45 + "px")
        .attr("height", (d) => d["height"] + 3 + "px")
        .attr("fill", function (d) {
          var value = d["AllNorm,N,19,11"];
          return color(value);
        })
        .lower();
    });

    g = svg.append("g");

    function ready(error, topo) {
      // Draw the map
      g.selectAll("d")
        .data(topo.features)
        .enter()
        .append("path")
        // draw each country
        .attr("d", d3.geoPath().projection(projection));
      // set the color of each country
    }

    function zoomed() {
      g.selectAll("path").attr("transform", d3.event.transform);
      svg.selectAll("rect").attr("transform", d3.event.transform);
    }

    var continentsBounds = {
      Africa: [-21.09375, -38.134557, 60.644531, 40.313043],
      "North America": [-168.046875, 9.795678, -22.148438, 73.922469],
      "South America": [-87.714844, -56.944974, -31.992188, 13.752725],
      Europe: [-24.257813, 35.960223, 47.109375, 71.130988],
      Asia: [35.859375, -8.754795, 178.417969, 77.579959],
      Oceania: [112.280273, -46.437857, 178.242188, -7.188101]
    };

    function clicked(c) {
      b = continentsBounds[c];
      console.log(projection([b[0], b[1]]));
      console.log(projection([b[2], b[3]]));

      var dx = projection([b[2], b[3]])[0] - projection([b[0], b[1]])[0],
        dy = projection([b[0], b[1]])[1] - projection([b[2], b[3]])[1],
        x = (projection([b[0], b[1]])[0] + projection([b[2], b[3]])[0]) / 2,
        y = (projection([b[0], b[1]])[1] + projection([b[2], b[3]])[1]) / 2,
        scale = Math.max(
          1,
          Math.min(8, 0.9 / Math.max(dx / width, dy / height))
        ),
        translate = [width / 2 - scale * x, height / 2 - scale * y];

      svg
        .transition()
        .duration(750)
        .call(
          zoom.transform,
          d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale)
        );
    }
  </script>
</body>
